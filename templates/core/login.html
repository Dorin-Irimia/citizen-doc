{% extends "base.html" %}
{% block title %}Autentificare{% endblock %}
{% block content %}
<style>
  /* Hero-style background cu particule */
  body {
    background: radial-gradient(circle at 20% 20%, #1f3b73 0%, #0d1d3a 35%, #0a1024 70%);
    color: #e8eef9;
  }
  #particles-js {
    position: fixed;
    inset: 0;
    z-index: 0;
    background: linear-gradient(135deg, rgba(21, 34, 68, 0.85), rgba(9, 12, 30, 0.9));
    pointer-events: none;
    user-select: none;
  }
  .login-wrapper {
    position: relative;
    z-index: 1;
    min-height: 70vh;
    display: flex;
    align-items: center;
    padding: 40px 0;
  }
  .glass-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.35);
    color: #0c244d;
  }
  .auth-title {
    color: #e8eef9;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.45);
  }
  /* Nav vizibil peste fundal inchis */
  nav.navbar {
    background: rgba(6, 14, 34, 0.85) !important;
    backdrop-filter: blur(8px);
    position: relative;
    z-index: 2;
  }
  nav.navbar .navbar-brand,
  nav.navbar .nav-link {
    color: #e8eef9 !important;
  }
  nav.navbar .nav-link:hover {
    color: #9cc6ff !important;
  }
</style>

<div id="particles-js"></div>

<div class="login-wrapper">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-5">
        <h1 class="h4 mb-3 text-center auth-title">Conectare cetatean</h1>
        <form method="post" class="card card-body shadow-sm glass-card">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div class="mb-3">
        <label class="form-label">CNP</label>
        {{ form.cnp }}
        {{ form.cnp.errors }}
      </div>
      <div class="mb-3">
        <label class="form-label">Parola</label>
        <div class="input-group">
          {{ form.password }}
          <button class="btn btn-outline-secondary" type="button" id="toggle-pass">üëÅ</button>
        </div>
        {{ form.password.errors }}
      </div>
      <div class="mb-3 text-end">
        <a href="{% url 'forgot_password_request' %}" class="small">Am uitat parola</a>
      </div>
      <button class="btn btn-primary w-100" id="login-btn">Conecteaza-te</button>
        </form>
        {% if wait_seconds %}
          <div class="alert alert-warning mt-2" id="wait-box">
            Asteapta <span id="wait-counter">{{ wait_seconds }}</span> secunde inainte de a reincepe.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  /* Configuratie particule (tema albastru-night) */
  if (window.particlesJS) {
    particlesJS("particles-js", {
      particles: {
        number: { value: 60, density: { enable: true, value_area: 900 } },
        color: { value: "#7db6ff" },
        shape: { type: "circle" },
        opacity: { value: 0.55, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: "#4d7ad1", opacity: 0.4, width: 1 },
        move: { enable: true, speed: 1.6, direction: "none", out_mode: "out" }
      },
      interactivity: {
        detect_on: "canvas",
        events: { onhover: { enable: true, mode: "grab" }, onclick: { enable: true, mode: "push" }, resize: true },
        modes: {
          grab: { distance: 180, line_linked: { opacity: 0.7 } },
          push: { particles_nb: 4 }
        }
      },
      retina_detect: true
    });
  }

  const btn = document.getElementById("toggle-pass");
  const input = document.getElementById("id_password");
  if (btn && input) {
    btn.addEventListener("click", () => {
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "üôà";
      } else {
        input.type = "password";
        btn.textContent = "üëÅ";
      }
    });
  }
  // countdown
  const waitBox = document.getElementById("wait-box");
  const counter = document.getElementById("wait-counter");
  const loginBtn = document.getElementById("login-btn");
  if (waitBox && counter && loginBtn) {
    let sec = parseInt(counter.textContent || "0", 10);
    loginBtn.disabled = true;
    const tick = () => {
      sec -= 1;
      if (sec <= 0) {
        waitBox.remove();
        loginBtn.disabled = false;
      } else {
        counter.textContent = sec;
        setTimeout(tick, 1000);
      }
    };
    setTimeout(tick, 1000);
  }
});
</script>
{% endblock %}
